# Copyright 2019 Chernov A.A.
# This is a part of mingw-portage project: 
# http://sourceforge.net/projects/mingwportage/
# Distributed under the terms of the GNU General Public License v2

DESCRIPTION="Newlib is a C library intended for use on embedded systems"

HOMEPAGE="https://sourceware.org/newlib/"

RESTRICT="strip"

MY_PN="newlib"
MY_P="${MY_PN}-${PV}"

SRC_URI="ftp://sourceware.org/pub/newlib/${MY_P}.tar.gz"

LICENSE="NEWLIB LIBGLOSS GPL-2"

DEPEND="dev-embedded/arm-none-eabi-binutils
		dev-embedded/arm-none-eabi-gcc || dev-embedded/arm-none-eabi-gcc-stage1"

SOURCES_DIR="${MY_P}"
BUILD_IN_SEPARATE_DIR=yes

src_configure()
{
	econf --target=arm-none-eabi \
		--enable-newlib-mb --disable-nls \
		--disable-newlib-supplied-syscalls --enable-newlib-multithread
}

src_install()
{
	emake_install
	# strip libgcc
	local _arm_strip=arm-none-eabi-strip.exe
	find "${INSTDIR}${PREFIX}/arm-none-eabi/lib/" -iname '*.a' -execdir ${_arm_strip} --strip-debug {} +
}
