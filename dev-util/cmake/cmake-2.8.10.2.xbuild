# Copyright 2010-2013 Chernov A.A.
# Distributed under the terms of the GNU General Public License v2

DESCRIPTION="Cross platform Make"

HOMEPAGE="http://www.cmake.org/"

LICENSE="CMake"

RDEPEND="net-misc/curl
		dev-libs/expat
		sys-libs/zlib
		app-arch/libbz2
		app-arch/libarchive"

SRC_URI="http://www.cmake.org/files/v2.8/${P}.tar.gz"

src_prepare()
{
	epatch "${PN}-2.8.10.1-mingw32-bz2_check.patch"
}

# BUG: possible write to d:\msys_4_64\mingw64\

src_configure()
{

# key --parallel=${MAKEOPTS} give variuos failures...

	LDFLAGS="-Wl,--enable-auto-import" \
		./bootstrap --prefix="${PREFIX}" --system-libs --no-qt-gui
	checkexitcode $? "bootstrap failed"

	# fix native path of install prefix back to MSYS path
	cat CMakeCache.txt | sed -e "s/^CMAKE_INSTALL_PREFIX:PATH=.*$/CMAKE_INSTALL_PREFIX:PATH=\\${PREFIX}/" > CMakeCache.txt.new
	mv -f CMakeCache.txt.new CMakeCache.txt
}
